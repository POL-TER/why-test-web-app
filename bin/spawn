#!/usr/bin/env node

const {spawn} = require('child_process');

const appProcess = spawn('bin/www');

appProcess.stdout.on('data', (data) => {
  console.log(`${data}`);
});

appProcess.stderr.on('data', (data) => {
  console.error(`${data}`);
});

let testProcess = null;

process.stdin.on('data', (data) => {
  if (data.toString().trim().toLowerCase() === 'test' && !testProcess) {

    console.log('Executing Tests');
    testProcess = spawn('npm', ['test']);

    testProcess.stdout.on('data', (data) => {
      console.log(`${data}`);
    });
    
    testProcess.stderr.on('data', (data) => {
      console.error(`${data}`);
    });
    
    testProcess.on('close', (data) => {
      testProcess = null;
    });
  }
});
